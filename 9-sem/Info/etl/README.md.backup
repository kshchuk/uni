# ETL Pipeline –¥–ª—è TechMarket DWH

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π ETL (Extract-Transform-Load) –ø–∞–∫–µ—Ç –¥–ª—è –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–∏—Ö –∑ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö –±–∞–∑ –¥–∞–Ω–∏—Ö MySQL –¥–æ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞ PostgreSQL.

## üìã –ó–º—ñ—Å—Ç

- [–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è)
- [–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è](#–∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è)
- [–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è](#–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è)
- [–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è](#—Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)
- [–ú–æ–¥—É–ª—ñ](#–º–æ–¥—É–ª—ñ)
- [Troubleshooting](#troubleshooting)

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

ETL pipeline —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ 5 –æ—Å–Ω–æ–≤–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤:

```
etl/
‚îú‚îÄ‚îÄ config.py       # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –ø—ñ–¥–∫–ª—é—á–µ–Ω—å
‚îú‚îÄ‚îÄ extract.py      # –ï–∫—Å—Ç—Ä–∞–∫—Ü—ñ—è –∑ OLTP –±–∞–∑
‚îú‚îÄ‚îÄ transform.py    # –û—á–∏—â–µ–Ω–Ω—è —Ç–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ load.py         # –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ DWH
‚îî‚îÄ‚îÄ pipeline.py     # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–æ—Ü–µ—Å—É
```

### –î–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö (OLTP):
- **orders** - MySQL –±–∞–∑–∞ –∑ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º–∏, –∫–ª—ñ—î–Ω—Ç–∞–º–∏, —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞–º–∏
- **catalog** - MySQL –±–∞–∑–∞ –∑ —Ç–æ–≤–∞—Ä–∞–º–∏ —Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏
- **payments** - MySQL –±–∞–∑–∞ –∑ –ø–ª–∞—Ç–µ–∂–∞–º–∏

### –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è (DWH):
- **PostgreSQL** - –ê–Ω–∞–ª—ñ—Ç–∏—á–Ω–µ —Å—Ö–æ–≤–∏—â–µ –∑ star schema

## üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### 1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:

```bash
cd etl/
pip install -r requirements.txt
```

### 2. –°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:

```bash
cp .env.example .env
```

### 3. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —É `.env`:

```env
# MySQL OLTP Databases
ORDERS_DB_HOST=localhost
ORDERS_DB_PORT=3306
ORDERS_DB_NAME=techmarket_orders
ORDERS_DB_USER=root
ORDERS_DB_PASSWORD=rootpassword

CATALOG_DB_HOST=localhost
CATALOG_DB_PORT=3306
CATALOG_DB_NAME=techmarket_catalog
CATALOG_DB_USER=root
CATALOG_DB_PASSWORD=rootpassword

PAYMENTS_DB_HOST=localhost
PAYMENTS_DB_PORT=3306
PAYMENTS_DB_NAME=techmarket_payments
PAYMENTS_DB_USER=root
PAYMENTS_DB_PASSWORD=rootpassword

AUTH_DB_HOST=localhost
AUTH_DB_PORT=3306
AUTH_DB_NAME=techmarket_auth
AUTH_DB_USER=root
AUTH_DB_PASSWORD=rootpassword

# PostgreSQL DWH
DWH_DB_HOST=localhost
DWH_DB_PORT=5432
DWH_DB_NAME=techmarket_dwh
DWH_DB_USER=postgres
DWH_DB_PASSWORD=postgres

# ETL Configuration
ETL_INCREMENTAL=false
# ETL_START_DATE=2024-01-01
# ETL_END_DATE=2024-12-31
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å | –ü—Ä–∏–∫–ª–∞–¥ |
|----------|------|---------|
| `ORDERS_DB_HOST` | –•–æ—Å—Ç MySQL –±–∞–∑–∏ orders | `localhost` |
| `ORDERS_DB_PORT` | –ü–æ—Ä—Ç MySQL –±–∞–∑–∏ orders | `3306` |
| `ORDERS_DB_NAME` | –ù–∞–∑–≤–∞ –±–∞–∑–∏ orders | `techmarket_orders` |
| `DWH_DB_HOST` | –•–æ—Å—Ç PostgreSQL DWH | `localhost` |
| `DWH_DB_PORT` | –ü–æ—Ä—Ç PostgreSQL DWH | `5432` |
| `ETL_INCREMENTAL` | –Ü–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è | `false` |
| `ETL_START_DATE` | –ü–æ—á–∞—Ç–∫–æ–≤–∞ –¥–∞—Ç–∞ –¥–ª—è —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ ETL | `2024-01-01` |
| `ETL_END_DATE` | –ö—ñ–Ω—Ü–µ–≤–∞ –¥–∞—Ç–∞ –¥–ª—è —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ ETL | `2024-12-31` |

### –†–µ–∂–∏–º–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

#### Full Load (–ü–æ–≤–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è)
```env
ETL_INCREMENTAL=false
```

–í–∏–∫–æ–Ω—É—î:
1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è (dim_date)
2. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö dimension —Ç–∞–±–ª–∏—Ü—å
3. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö fact –∑–∞–ø–∏—Å—ñ–≤

#### Incremental Load (–Ü–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è)
```env
ETL_INCREMENTAL=true
ETL_START_DATE=2024-01-01
ETL_END_DATE=2024-01-31
```

–í–∏–∫–æ–Ω—É—î:
- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ fact_sales –∑–∞ –≤–∫–∞–∑–∞–Ω–∏–π –ø–µ—Ä—ñ–æ–¥

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ë–∞–∑–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```python
from etl.config import ETLConfig
from etl.pipeline import ETLPipeline

# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –∑ .env
config = ETLConfig.from_env()

# –°—Ç–≤–æ—Ä–∏—Ç–∏ pipeline
pipeline = ETLPipeline(config)

# –í–∏–∫–æ–Ω–∞—Ç–∏ –ø–æ–≤–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
pipeline.run_full_load()

# –ê–±–æ —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
# pipeline.run_incremental_load()
```

### –ó–∞–ø—É—Å–∫ –∑ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞

```bash
# –ü–æ–≤–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
python -m etl.pipeline

# –Ü–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
ETL_INCREMENTAL=true \
ETL_START_DATE=2024-01-01 \
ETL_END_DATE=2024-01-31 \
python -m etl.pipeline
```

### –ü—Ä–æ–≥—Ä–∞–º–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –æ–∫—Ä–µ–º–∏—Ö –º–æ–¥—É–ª—ñ–≤

#### Extract

```python
from etl.config import MySQLConfig
from etl.extract import OrdersExtractor

config = MySQLConfig(
    host='localhost',
    port=3306,
    database='techmarket_orders',
    user='root',
    password='rootpassword'
)

extractor = OrdersExtractor(config)

# –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
orders_df = extractor.extract_orders()

# –û—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞ –ø–µ—Ä—ñ–æ–¥
orders_df = extractor.extract_orders(
    start_date=datetime(2024, 1, 1),
    end_date=datetime(2024, 1, 31)
)

extractor.close()
```

#### Transform

```python
from etl.transform import DataTransformer, DataCleaner

cleaner = DataCleaner()
transformer = DataTransformer()

# –û—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ
orders_df = cleaner.remove_duplicates(orders_df, subset=['order_id', 'order_item_id'])
orders_df = cleaner.handle_missing_values(orders_df, strategy='drop')

# –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
orders_df = transformer.transform_orders(orders_df)

# –ê–≥—Ä–µ–≥—É–≤–∞—Ç–∏ –∑–∞ –ø–µ—Ä—ñ–æ–¥
daily_sales = transformer.aggregate_sales_by_period(orders_df, period='D')
```

#### Load

```python
from etl.config import PostgreSQLConfig
from etl.load import Loader

config = PostgreSQLConfig(
    host='localhost',
    port=5432,
    database='techmarket_dwh',
    user='postgres',
    password='postgres'
)

loader = Loader(config)

# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ dimension
loader.load_dimension(
    df=regions_df,
    table_name='dim_region',
    if_exists='replace'
)

# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ fact
loader.load_fact_sales(fact_sales_df)

loader.close()
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ó–∞–ø—É—Å–∫ –≤—Å—ñ—Ö —Ç–µ—Å—Ç—ñ–≤

```bash
pytest etl/tests/
```

### –ó–∞–ø—É—Å–∫ –∑ coverage –∑–≤—ñ—Ç–æ–º

```bash
pytest --cov=etl --cov-report=html etl/tests/
```

### –ó–∞–ø—É—Å–∫ –æ–∫—Ä–µ–º–∏—Ö —Ç–µ—Å—Ç—ñ–≤

```bash
# –¢–µ—Å—Ç–∏ –¥–ª—è extract
pytest etl/tests/test_extract.py

# –¢–µ—Å—Ç–∏ –¥–ª—è transform
pytest etl/tests/test_transform.py

# –¢–µ—Å—Ç–∏ –¥–ª—è load
pytest etl/tests/test_load.py

# –¢–µ—Å—Ç–∏ –¥–ª—è pipeline
pytest etl/tests/test_pipeline.py
```

### –ó–∞–ø—É—Å–∫ –∑ –¥–µ—Ç–∞–ª—å–Ω–∏–º –≤–∏–≤–æ–¥–æ–º

```bash
pytest -v etl/tests/
```

## üìö –ú–æ–¥—É–ª—ñ

### config.py

–ö–ª–∞—Å–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω—å –¥–æ –±–∞–∑ –¥–∞–Ω–∏—Ö.

**–û—Å–Ω–æ–≤–Ω—ñ –∫–ª–∞—Å–∏:**
- `DatabaseConfig` - –±–∞–∑–æ–≤–∏–π –∫–ª–∞—Å
- `MySQLConfig` - –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è MySQL
- `PostgreSQLConfig` - –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è PostgreSQL
- `ETLConfig` - –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä –≤—Å—ñ—Ö –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π

**–ú–µ—Ç–æ–¥–∏:**
- `connection_string` - –ø–æ–±—É–¥–æ–≤–∞ connection string
- `from_env()` - –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ environment variables

### extract.py

–ï–∫—Å—Ç—Ä–∞–∫—Ü—ñ—è –¥–∞–Ω–∏—Ö –∑ OLTP –±–∞–∑ –¥–∞–Ω–∏—Ö.

**–û—Å–Ω–æ–≤–Ω—ñ –∫–ª–∞—Å–∏:**
- `Extractor` - –±–∞–∑–æ–≤–∏–π –∫–ª–∞—Å –µ–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä–∞
- `OrdersExtractor` - –µ–∫—Å—Ç—Ä–∞–∫—Ü—ñ—è –∑ orders DB
- `CatalogExtractor` - –µ–∫—Å—Ç—Ä–∞–∫—Ü—ñ—è –∑ catalog DB
- `PaymentsExtractor` - –µ–∫—Å—Ç—Ä–∞–∫—Ü—ñ—è –∑ payments DB

**–ö–ª—é—á–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:**
- Lazy initialization –∑'—î–¥–Ω–∞–Ω–Ω—è —á–µ—Ä–µ–∑ `@property`
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø–æ –¥–∞—Ç–∞—Ö
- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –Ω–∞–±–æ—Ä—ñ–≤ –¥–∞–Ω–∏—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è –∑'—î–¥–Ω–∞–Ω—å

### transform.py

–û—á–∏—â–µ–Ω–Ω—è —Ç–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö.

**–û—Å–Ω–æ–≤–Ω—ñ –∫–ª–∞—Å–∏:**
- `DataCleaner` - –æ—á–∏—â–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
- `DataTransformer` - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è —Ç–∞ –∞–≥—Ä–µ–≥–∞—Ü—ñ—è

**DataCleaner –º–µ—Ç–æ–¥–∏:**
- `remove_duplicates()` - –≤–∏–¥–∞–ª–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤
- `handle_missing_values()` - –æ–±—Ä–æ–±–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å
- `validate_data_types()` - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∏–ø—ñ–≤ –¥–∞–Ω–∏—Ö

**DataTransformer –º–µ—Ç–æ–¥–∏:**
- `transform_orders()` - —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –º–µ—Ç—Ä–∏–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å
- `transform_customers()` - –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–ª—ñ—î–Ω—Ç—ñ–≤
- `transform_products()` - –æ–±—Ä–æ–±–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤
- `aggregate_sales_by_period()` - –∞–≥—Ä–µ–≥–∞—Ü—ñ—è –ø–æ –ø–µ—Ä—ñ–æ–¥–∞—Ö
- `aggregate_sales_by_product()` - –∞–≥—Ä–µ–≥–∞—Ü—ñ—è –ø–æ —Ç–æ–≤–∞—Ä–∞—Ö
- `aggregate_sales_by_employee()` - –∞–≥—Ä–µ–≥–∞—Ü—ñ—è –ø–æ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞—Ö

### load.py

–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —É DWH.

**–û—Å–Ω–æ–≤–Ω–∏–π –∫–ª–∞—Å:**
- `Loader` - –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—á –¥–∞–Ω–∏—Ö

**–ú–µ—Ç–æ–¥–∏:**
- `load_dimension()` - –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è dimension —Ç–∞–±–ª–∏—Ü—ñ
- `load_fact_sales()` - –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è fact_sales
- `load_dim_date()` - –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
- `truncate_table()` - –æ—á–∏—â–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ
- `upsert_dimension()` - INSERT/UPDATE dimension
- `get_existing_keys()` - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ—Å–Ω—É—é—á–∏—Ö –∫–ª—é—á—ñ–≤

**–ö–ª—é—á–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:**
- Batch loading –∑ chunking
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –æ–±–æ–≤'—è–∑–∫–æ–≤–∏—Ö –∫–æ–ª–æ–Ω–æ–∫
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ replace/append —Ä–µ–∂–∏–º—ñ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∑ date_key

### pipeline.py

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—è ETL –ø—Ä–æ—Ü–µ—Å—É.

**–û—Å–Ω–æ–≤–Ω–∏–π –∫–ª–∞—Å:**
- `ETLPipeline` - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä ETL

**–ú–µ—Ç–æ–¥–∏:**
- `run_full_load()` - –ø–æ–≤–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (7 –∫—Ä–æ–∫—ñ–≤)
- `run_incremental_load()` - —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- `_cleanup()` - –∑–∞–∫—Ä–∏—Ç—Ç—è –≤—Å—ñ—Ö –∑'—î–¥–Ω–∞–Ω—å

**7 –∫—Ä–æ–∫—ñ–≤ –ø–æ–≤–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:**
1. `_load_dim_date()` - –∫–∞–ª–µ–Ω–¥–∞—Ä
2. `_load_dim_region()` - —Ä–µ–≥—ñ–æ–Ω–∏
3. `_load_dim_category()` - –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
4. `_load_dim_product()` - —Ç–æ–≤–∞—Ä–∏
5. `_load_dim_customer()` - –∫–ª—ñ—î–Ω—Ç–∏
6. `_load_dim_employee()` - —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏
7. `_load_fact_sales()` - —Ñ–∞–∫—Ç –ø—Ä–æ–¥–∞–∂—ñ–≤

## üîß Troubleshooting

### –ü–æ–º–∏–ª–∫–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

**–ü—Ä–æ–±–ª–µ–º–∞:** `Can't connect to MySQL server`

**–†—ñ—à–µ–Ω–Ω—è:**
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –ø—Ä–∞—Ü—é—é—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
docker-compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
docker-compose restart

# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏
docker-compose logs mysql_orders
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `FATAL: password authentication failed`

**–†—ñ—à–µ–Ω–Ω—è:**
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ credentials —É .env
cat .env

# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –∑–±—ñ–≥–∞—é—Ç—å—Å—è –∑ docker-compose.yml
```

### –ü–æ–º–∏–ª–∫–∏ –¥–∞–Ω–∏—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** `Missing required columns in fact_sales`

**–†—ñ—à–µ–Ω–Ω—è:**
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ transform_orders() —Å—Ç–≤–æ—Ä—é—î –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –∫–æ–ª–æ–Ω–∫–∏:
- date_key
- revenue
- cost
- margin
- discount_amount

**–ü—Ä–æ–±–ª–µ–º–∞:** `Duplicate key violation`

**–†—ñ—à–µ–Ω–Ω—è:**
```python
# –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –æ—á–∏—â–µ–Ω–Ω—è –≤—ñ–¥ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤
cleaner = DataCleaner()
df = cleaner.remove_duplicates(df, subset=['primary_key_column'])
```

### –ü—Ä–æ–±–ª–µ–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

**–ü—Ä–æ–±–ª–µ–º–∞:** ETL –ø—Ä–∞—Ü—é—î –ø–æ–≤—ñ–ª—å–Ω–æ

**–†—ñ—à–µ–Ω–Ω—è:**
1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
2. –ó–±—ñ–ª—å—à—Ç–µ chunksize:
```python
loader.load_dimension(df, 'dim_product', chunksize=5000)
```
3. –î–æ–¥–∞–π—Ç–µ —ñ–Ω–¥–µ–∫—Å–∏ –≤ DWH:
```sql
CREATE INDEX idx_fact_sales_date ON fact_sales(date_key);
```

### –ü—Ä–æ–±–ª–µ–º–∏ –∑ –ø–∞–º'—è—Ç—Ç—é

**–ü—Ä–æ–±–ª–µ–º–∞:** `MemoryError` –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –≤–µ–ª–∏–∫–∏—Ö —Ç–∞–±–ª–∏—Ü—å

**–†—ñ—à–µ–Ω–Ω—è:**
```python
# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ chunksize –≤ extract
for chunk in extractor.extract_orders(chunksize=10000):
    # –û–±—Ä–æ–±–∫–∞ chunk
    transformed = transformer.transform_orders(chunk)
    loader.load_fact_sales(transformed, if_exists='append')
```

## üìù –õ–æ–≥—É–≤–∞–Ω–Ω—è

Pipeline –≤–µ–¥–µ –¥–µ—Ç–∞–ª—å–Ω–∏–π –ª–æ–≥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:

```
2024-01-15 10:30:00 - ETL Pipeline - INFO - –ü–æ—á–∞—Ç–æ–∫ ETL –ø—Ä–æ—Ü–µ—Å—É
2024-01-15 10:30:01 - ETL Pipeline - INFO - –ö—Ä–æ–∫ 1/7: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è dim_date
2024-01-15 10:30:05 - ETL Pipeline - INFO - –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ 365 –∑–∞–ø–∏—Å—ñ–≤ —É dim_date
2024-01-15 10:30:05 - ETL Pipeline - INFO - –ö—Ä–æ–∫ 2/7: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è dim_region
...
2024-01-15 10:35:00 - ETL Pipeline - INFO - ETL –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ
```

## ü§ù –†–æ–∑—Ä–æ–±–∫–∞

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ extractor

1. –°—Ç–≤–æ—Ä—ñ—Ç—å –∫–ª–∞—Å-–Ω–∞—â–∞–¥–æ–∫ `Extractor`:
```python
class NewExtractor(Extractor):
    def extract_data(self) -> pd.DataFrame:
        query = "SELECT * FROM new_table"
        return self.extract_query(query)
```

2. –î–æ–¥–∞–π—Ç–µ –¥–æ `pipeline.py`:
```python
self.new_extractor = NewExtractor(config.new_db)
```

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ—ó —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó

```python
class DataTransformer:
    def transform_new_data(self, df: pd.DataFrame) -> pd.DataFrame:
        # –í–∞—à–∞ –ª–æ–≥—ñ–∫–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó
        return df
```

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç—É

```python
def test_new_feature():
    """–¢–µ—Å—Ç –Ω–æ–≤–æ—ó —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ."""
    # Arrange
    # Act
    # Assert
```

## üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è

–¶–µ–π –ø—Ä–æ–µ–∫—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —Ü—ñ–ª–µ–π –≤ —Ä–∞–º–∫–∞—Ö –∫—É—Ä—Å—É "–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω—ñ —Å–∏—Å—Ç–µ–º–∏".

## üë§ –ê–≤—Ç–æ—Ä

**Yaroslav Kischuk**
- Email: yaroslav.kischuk@student.uzhnu.edu.ua
- GitHub: [@yaroslav-kischuk](https://github.com/yaroslav-kischuk)
