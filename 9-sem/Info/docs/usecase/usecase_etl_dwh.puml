@startuml TechMarket_ETL_DWH
title TechMarket — ETL / DWH (PostgreSQL)
left to right direction

actor "Планувальник ETL (Cron/Airflow)" as Sched
actor "Операційні БД (MySQL, DB‑per‑service)" as OLTP

rectangle "DWH (PostgreSQL)" as DWH {
  usecase "Виконати Extract з MySQL" as E1
  usecase "Завантажити у Staging" as E2
  usecase "Побудувати виміри (dim_*)" as E3
  usecase "Побудувати факт продажів (fact_sales)" as E4
  usecase "Інкрементальне завантаження\nза watermarks" as E5
  usecase "Перевірити якість даних (DQ)" as E6
  usecase "Логування та аудит завантажень" as E7
  
  ' Service auth use cases (узагальнено)
  usecase "Аутентифікація сервісу" as SA1
  usecase "Перевірити доступ сервісу" as SA2
}

usecase "Запустити щоденний pipeline ETL" as PIPE
PIPE ..> E1 : <<include>>
PIPE ..> E2 : <<include>>
PIPE ..> E3 : <<include>>
PIPE ..> E4 : <<include>>
PIPE ..> E6 : <<include>>
PIPE ..> E7 : <<include>>
PIPE ..> SA2 : <<include>>
E5 ..|> PIPE : <<extend>>

Sched -- PIPE
Sched -- SA1
OLTP -- E1 : джерело

@enduml
