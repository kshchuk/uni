@startuml TechMarket_Sequence_Auth_Login
title TechMarket — Sequence: Вхід користувача (Microservices)
autonumber

actor "Користувач" as User
boundary "Веб/Мобільний UI" as UI
boundary "API Gateway" as GW
control "Auth Service" as AUTH
database "Auth DB" as DB_AUTH
collections "Аудит/Логи" as LOG

User -> UI: Ввести email + пароль
UI -> GW: POST /auth/login {email, password}
activate GW
GW -> AUTH: login(email, password)
activate AUTH

AUTH -> LOG: login_attempt(email)
AUTH -> DB_AUTH: Отримати користувача за email
DB_AUTH --> AUTH: user(опційно)

alt Користувача не знайдено або status!=active
  API -> LOG: login_failed(email, reason)
  API --> UI: 401 Unauthorized
  deactivate API
  return
end

AUTH -> AUTH: Перевірити пароль
alt Пароль невірний
  API -> LOG: login_failed(email, reason='bad_password')
  API --> UI: 401 Unauthorized
  deactivate API
  return
else ОК
  AUTH -> AUTH: Створити сесію/токен доступу
  AUTH -> DB_AUTH: Зберегти сесію/токен доступу
  AUTH -> LOG: login_success(user_id)
  AUTH --> GW: 200 OK { access_token, expires_at }
end
deactivate AUTH
GW --> UI: 200 OK { access_token, expires_at }
deactivate GW

@enduml
